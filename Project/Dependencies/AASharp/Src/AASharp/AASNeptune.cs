using System;

namespace AASharp
{
    public static class AASNeptune
    {
        #region coefficients
        
        static readonly VSOP87Coefficient[] g_L0NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 531188633,  0,          0          ),
            new VSOP87Coefficient( 1798476,    2.9010127,  38.1330356 ),
            new VSOP87Coefficient( 1019728,    0.4858092,  1.4844727  ),
            new VSOP87Coefficient( 124532,     4.830081,   36.648563  ),
            new VSOP87Coefficient( 42064,      5.41055,    2.96895    ),
            new VSOP87Coefficient( 37715,      6.09222,    35.16409   ),
            new VSOP87Coefficient( 33785,      1.24489,    76.26607   ),
            new VSOP87Coefficient( 16483,      0.00008,    491.55793  ),
            new VSOP87Coefficient( 9199,       4.9375,     39.6175    ),
            new VSOP87Coefficient( 8994,       0.2746,     175.1661   ),
            new VSOP87Coefficient( 4216,       1.9871,     73.2971    ),
            new VSOP87Coefficient( 3365,       1.0359,     33.6796    ),
            new VSOP87Coefficient( 2285,       4.2061,     4.4534     ),
            new VSOP87Coefficient( 1434,       2.7834,     74.7816    ),
            new VSOP87Coefficient( 900,        2.076,      109.946    ),
            new VSOP87Coefficient( 745,        3.190,      71.813     ),
            new VSOP87Coefficient( 506,        5.748,      114.399    ),
            new VSOP87Coefficient( 400,        0.350,      1021.249   ),
            new VSOP87Coefficient( 345,        3.462,      41.102     ),
            new VSOP87Coefficient( 340,        3.304,      77.751     ),
            new VSOP87Coefficient( 323,        2.248,      32.195     ),
            new VSOP87Coefficient( 306,        0.497,      0.521      ),
            new VSOP87Coefficient( 287,        4.505,      0.048      ),
            new VSOP87Coefficient( 282,        2.246,      146.594    ),
            new VSOP87Coefficient( 267,        4.889,      0.963      ),
            new VSOP87Coefficient( 252,        5.782,      388.465    ),
            new VSOP87Coefficient( 245,        1.247,      9.561      ),
            new VSOP87Coefficient( 233,        2.505,      137.033    ),
            new VSOP87Coefficient( 227,        1.797,      453.425    ),
            new VSOP87Coefficient( 170,        3.324,      108.461    ),
            new VSOP87Coefficient( 151,        2.192,      33.940     ),
            new VSOP87Coefficient( 150,        2.997,      5.938      ),
            new VSOP87Coefficient( 148,        0.859,      111.430    ),
            new VSOP87Coefficient( 119,        3.677,      2.448      ),
            new VSOP87Coefficient( 109,        2.416,      183.243    ),
            new VSOP87Coefficient( 103,        0.041,      0.261      ),
            new VSOP87Coefficient( 103,        4.404,      70.328     ),
            new VSOP87Coefficient( 102,        5.705,      0.112      ) 
        };
        
        static readonly VSOP87Coefficient[] g_L1NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 3837687717.0, 0,        0        ),
            new VSOP87Coefficient( 16604,        4.86319,  1.48447  ),
            new VSOP87Coefficient( 15807,        2.27923,  38.13304 ),
            new VSOP87Coefficient( 3335,         3.6820,   76.2661  ),
            new VSOP87Coefficient( 1306,         3.6732,   2.9689   ),
            new VSOP87Coefficient( 605,          1.505,    35.164   ),
            new VSOP87Coefficient( 179,          3.453,    39.618   ),
            new VSOP87Coefficient( 107,          2.451,    4.453    ),
            new VSOP87Coefficient( 106,          2.755,    33.680   ),
            new VSOP87Coefficient( 73,           5.49,     36.65    ),
            new VSOP87Coefficient( 57,           1.86,     114.40   ),
            new VSOP87Coefficient( 57,           5.22,     0.52     ),
            new VSOP87Coefficient( 35,           4.52,     74.78    ),
            new VSOP87Coefficient( 32,           5.90,     77.75    ),
            new VSOP87Coefficient( 30,           3.67,     388.47   ),
            new VSOP87Coefficient( 29,           5.17,     9.56     ),
            new VSOP87Coefficient( 29,           5.17,     2.45     ),
            new VSOP87Coefficient( 26,           5.25,     168.05   )
        };
        
        static readonly VSOP87Coefficient[] g_L2NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 53893, 0,     0      ),
            new VSOP87Coefficient( 296,   1.855, 1.484  ),
            new VSOP87Coefficient( 281,   1.191, 38.133 ),
            new VSOP87Coefficient( 270,   5.721, 76.266 ),
            new VSOP87Coefficient( 23,    1.21,  2.97   ),
            new VSOP87Coefficient( 9,     4.43,  35.16  ),
            new VSOP87Coefficient( 7,     0.54,  2.45   )
        };
        
        static readonly VSOP87Coefficient[] g_L3NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 31, 0,    0     ),
            new VSOP87Coefficient( 15, 1.35, 76.27 ),
            new VSOP87Coefficient( 12, 6.04, 1.48  ),
            new VSOP87Coefficient( 12, 6.11, 38.13 )
        };
        
        static readonly VSOP87Coefficient[] g_L4NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 114, 3.142,  0 )
        };
        
        static readonly VSOP87Coefficient[] g_B0NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 3088623, 1.4410437, 38.1330356 ),
            new VSOP87Coefficient( 27780,   5.91272,   76.26607   ),
            new VSOP87Coefficient( 27624,   0,         0          ),
            new VSOP87Coefficient( 15448,   3.50877,   39.61751   ),
            new VSOP87Coefficient( 15355,   2.52124,   36.64856   ),
            new VSOP87Coefficient( 2000,    1.5100,    74.7816    ),
            new VSOP87Coefficient( 1968,    4.3778,    1.4845     ),
            new VSOP87Coefficient( 1015,    3.2156,    35.1641    ),
            new VSOP87Coefficient( 606,     2.802,     73.297     ),
            new VSOP87Coefficient( 595,     2.129,     41.102     ),
            new VSOP87Coefficient( 589,     3.187,     2.969      ),
            new VSOP87Coefficient( 402,     4.169,     114.399    ),
            new VSOP87Coefficient( 280,     1.682,     77.751     ),
            new VSOP87Coefficient( 262,     3.767,     213.299    ),
            new VSOP87Coefficient( 254,     3.271,     453.425    ),
            new VSOP87Coefficient( 206,     4.257,     529.691    ),
            new VSOP87Coefficient( 140,     3.530,     137.033    )
        };
        
        static readonly VSOP87Coefficient[] g_B1NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 227279, 3.807931, 38.133036 ),
            new VSOP87Coefficient( 1803,   1.9758,   76.2661   ),
            new VSOP87Coefficient( 1433,   3.1416,   0         ),
            new VSOP87Coefficient( 1386,   4.8256,   36.6486   ),
            new VSOP87Coefficient( 1073,   6.0805,   39.6175   ),
            new VSOP87Coefficient( 148,    3.858,    74.782    ),
            new VSOP87Coefficient( 136,    0.478,    1.484     ),
            new VSOP87Coefficient( 70,     6.19,     35.16     ),
            new VSOP87Coefficient( 52,     5.05,     73.30     ),
            new VSOP87Coefficient( 43,     0.31,     114.40    ),
            new VSOP87Coefficient( 37,     4.89,     41.10     ),
            new VSOP87Coefficient( 37,     5.76,     2.97      ),
            new VSOP87Coefficient( 26,     5.22,     213.30    )
        };
        
        static readonly VSOP87Coefficient[] g_B2NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 9691, 5.5712, 38.1330 ),
            new VSOP87Coefficient( 79,   3.63,   76.27   ),
            new VSOP87Coefficient( 72,   0.45,   36.65   ),
            new VSOP87Coefficient( 59,   3.14,   0       ),
            new VSOP87Coefficient( 30,   1.61,   39.62   ),
            new VSOP87Coefficient( 6,    5.61,   74.78   )
        };
        
        static readonly VSOP87Coefficient[] g_B3NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 273, 1.017, 38.133 ),
            new VSOP87Coefficient( 2,   0,     0      ),
            new VSOP87Coefficient( 2,   2.37,  36.65  ),
            new VSOP87Coefficient( 2,   5.33,  76.27  )
        };
        
        static readonly VSOP87Coefficient[] g_B4NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 6, 2.67, 38.13 )
        };
        
        static readonly VSOP87Coefficient[] g_R0NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 3007013206.0, 0,          0           ),
            new VSOP87Coefficient( 27062259,     1.32999459, 38.13303564 ),
            new VSOP87Coefficient( 1691764,      3.2518614,  36.6485629  ),
            new VSOP87Coefficient( 807831,       5.185928,   1.484473    ),
            new VSOP87Coefficient( 537761,       4.521139,   35.164090   ),
            new VSOP87Coefficient( 495726,       1.571057,   491.557929  ),
            new VSOP87Coefficient( 274572,       1.845523,   175.166060  ),
            new VSOP87Coefficient( 135134,       3.372206,   39.617508   ),
            new VSOP87Coefficient( 121802,       5.797544,   76.266071   ),
            new VSOP87Coefficient( 100895,       0.377027,   73.297126   ),
            new VSOP87Coefficient( 69792,        3.79617,    2.96895     ),
            new VSOP87Coefficient( 46688,        5.74938,    33.67962    ),
            new VSOP87Coefficient( 24594,        0.50802,    109.94569   ),
            new VSOP87Coefficient( 16939,        1.59422,    71.81265    ),
            new VSOP87Coefficient( 14230,        1.07786,    74.78160    ),
            new VSOP87Coefficient( 12012,        1.92062,    1021.24889  ),
            new VSOP87Coefficient( 8395,         0.6782,     146.5943    ),
            new VSOP87Coefficient( 7572,         1.0715,     388.4652    ),
            new VSOP87Coefficient( 5721,         2.5906,     4.4534      ),
            new VSOP87Coefficient( 4840,         1.9069,     41.1020     ),
            new VSOP87Coefficient( 4483,         2.9057,     529.6910    ),
            new VSOP87Coefficient( 4421,         1.7499,     108.4612    ),
            new VSOP87Coefficient( 4354,         0.6799,     32.1951     ),
            new VSOP87Coefficient( 4270,         3.4134,     453.4249    ),
            new VSOP87Coefficient( 3381,         0.8481,     183.2428    ),
            new VSOP87Coefficient( 2881,         1.9860,     137.0330    ),
            new VSOP87Coefficient( 2879,         3.6742,     350.3321    ),
            new VSOP87Coefficient( 2636,         3.0976,     213.2991    ),
            new VSOP87Coefficient( 2530,         5.7984,     490.0735    ),
            new VSOP87Coefficient( 2523,         0.4863,     493.0424    ),
            new VSOP87Coefficient( 2306,         2.8096,     70.3282     ),
            new VSOP87Coefficient( 2087,         0.6186,     33.9402     )
        };
        
        static readonly VSOP87Coefficient[] g_R1NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 236339, 0.704980, 38.133036 ),
            new VSOP87Coefficient( 13220,  3.32015,  1.48447   ),
            new VSOP87Coefficient( 8622,   6.2163,   35.1641   ),
            new VSOP87Coefficient( 2702,   1.8814,   39.6175   ),
            new VSOP87Coefficient( 2155,   2.0943,   2.9689    ),
            new VSOP87Coefficient( 2153,   5.1687,   76.2661   ),
            new VSOP87Coefficient( 1603,   0,        0         ),
            new VSOP87Coefficient( 1464,   1.1842,   33.6796   ),
            new VSOP87Coefficient( 1136,   3.9189,   36.6486   ),
            new VSOP87Coefficient( 898,    5.241,    388.465   ),
            new VSOP87Coefficient( 790,    0.533,    168.053   ),
            new VSOP87Coefficient( 760,    0.021,    182.280   ),
            new VSOP87Coefficient( 607,    1.077,    1021.249  ),
            new VSOP87Coefficient( 572,    3.401,    484.444   ),
            new VSOP87Coefficient( 561,    2.887,    498.671   )
        };
        
        static readonly VSOP87Coefficient[] g_R2NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 4247, 5.8991, 38.1330 ),
            new VSOP87Coefficient( 218,  0.346,  1.484   ),
            new VSOP87Coefficient( 163,  2.239,  168.053 ),
            new VSOP87Coefficient( 156,  4.594,  182.280 ),
            new VSOP87Coefficient( 127,  2.848,  35.164  )
        };
        
        static readonly VSOP87Coefficient[] g_R3NeptuneCoefficients =
        { 
            new VSOP87Coefficient( 166,  4.552,  38.133 )
        };
        
        #endregion

        public static double EclipticLongitude(double JD, bool bHighPrecision)
        {
            if (bHighPrecision)
            {
                return AASCoordinateTransformation.MapTo0To360Range(AASCoordinateTransformation.RadiansToDegrees(AASVSOP87D_Neptune.L(JD)));
            }
            
            double rho = (JD - 2451545) / 365250;
            double rhosquared = rho * rho;
            double rhocubed = rhosquared * rho;
            double rho4 = rhocubed * rho;

            //Calculate L0
            int nL0Coefficients = g_L0NeptuneCoefficients.Length;
            double L0 = 0;
            int i;
            for (i = 0; i < nL0Coefficients; i++)
                L0 += g_L0NeptuneCoefficients[i].A * Math.Cos(g_L0NeptuneCoefficients[i].B + g_L0NeptuneCoefficients[i].C * rho);

            //Calculate L1
            int nL1Coefficients = g_L1NeptuneCoefficients.Length;
            double L1 = 0;
            for (i = 0; i < nL1Coefficients; i++)
                L1 += g_L1NeptuneCoefficients[i].A * Math.Cos(g_L1NeptuneCoefficients[i].B + g_L1NeptuneCoefficients[i].C * rho);

            //Calculate L2
            int nL2Coefficients = g_L2NeptuneCoefficients.Length;
            double L2 = 0;
            for (i = 0; i < nL2Coefficients; i++)
                L2 += g_L2NeptuneCoefficients[i].A * Math.Cos(g_L2NeptuneCoefficients[i].B + g_L2NeptuneCoefficients[i].C * rho);

            //Calculate L3
            int nL3Coefficients = g_L3NeptuneCoefficients.Length;
            double L3 = 0;
            for (i = 0; i < nL3Coefficients; i++)
                L3 += g_L3NeptuneCoefficients[i].A * Math.Cos(g_L3NeptuneCoefficients[i].B + g_L3NeptuneCoefficients[i].C * rho);

            //Calculate L4
            int nL4Coefficients = g_L4NeptuneCoefficients.Length;
            double L4 = 0;
            for (i = 0; i < nL4Coefficients; i++)
                L4 += g_L4NeptuneCoefficients[i].A * Math.Cos(g_L4NeptuneCoefficients[i].B + g_L4NeptuneCoefficients[i].C * rho);


            double value = (L0 + L1 * rho + L2 * rhosquared + L3 * rhocubed + L4 * rho4) / 100000000;

            //convert results back to degrees
            value = AASCoordinateTransformation.MapTo0To360Range(AASCoordinateTransformation.RadiansToDegrees(value));
            return value;
        }

        public static double EclipticLatitude(double JD, bool bHighPrecision)
        {
            if (bHighPrecision)
            {
                return AASCoordinateTransformation.MapToMinus90To90Range(AASCoordinateTransformation.RadiansToDegrees(AASVSOP87D_Neptune.B(JD)));
            }
            
            double rho = (JD - 2451545) / 365250;
            double rhosquared = rho * rho;
            double rhocubed = rhosquared * rho;
            double rho4 = rhocubed * rho;

            //Calculate B0
            int nB0Coefficients = g_B0NeptuneCoefficients.Length;
            double B0 = 0;
            int i;
            for (i = 0; i < nB0Coefficients; i++)
                B0 += g_B0NeptuneCoefficients[i].A * Math.Cos(g_B0NeptuneCoefficients[i].B + g_B0NeptuneCoefficients[i].C * rho);

            //Calculate B1
            int nB1Coefficients = g_B1NeptuneCoefficients.Length;
            double B1 = 0;
            for (i = 0; i < nB1Coefficients; i++)
                B1 += g_B1NeptuneCoefficients[i].A * Math.Cos(g_B1NeptuneCoefficients[i].B + g_B1NeptuneCoefficients[i].C * rho);

            //Calculate B2
            int nB2Coefficients = g_B2NeptuneCoefficients.Length;
            double B2 = 0;
            for (i = 0; i < nB2Coefficients; i++)
                B2 += g_B2NeptuneCoefficients[i].A * Math.Cos(g_B2NeptuneCoefficients[i].B + g_B2NeptuneCoefficients[i].C * rho);

            //Calculate B3
            int nB3Coefficients = g_B3NeptuneCoefficients.Length;
            double B3 = 0;
            for (i = 0; i < nB3Coefficients; i++)
                B3 += g_B3NeptuneCoefficients[i].A * Math.Cos(g_B3NeptuneCoefficients[i].B + g_B3NeptuneCoefficients[i].C * rho);

            //Calculate B4
            int nB4Coefficients = g_B4NeptuneCoefficients.Length;
            double B4 = 0;
            for (i = 0; i < nB4Coefficients; i++)
                B4 += g_B4NeptuneCoefficients[i].A * Math.Cos(g_B4NeptuneCoefficients[i].B + g_B4NeptuneCoefficients[i].C * rho);

            double value = (B0 + B1 * rho + B2 * rhosquared + B3 * rhocubed + B4 * rho4) / 100000000;

            //convert results back to degrees
            value = AASCoordinateTransformation.RadiansToDegrees(value);
            return value;
        }

        public static double RadiusVector(double JD, bool bHighPrecision)
        {
            if (bHighPrecision)
            {
                return AASVSOP87D_Neptune.R(JD);
            }
            
            double rho = (JD - 2451545) / 365250;
            double rhosquared = rho * rho;
            double rhocubed = rhosquared * rho;

            //Calculate R0
            int nR0Coefficients = g_R0NeptuneCoefficients.Length;
            double R0 = 0;
            int i;
            for (i = 0; i < nR0Coefficients; i++)
                R0 += g_R0NeptuneCoefficients[i].A * Math.Cos(g_R0NeptuneCoefficients[i].B + g_R0NeptuneCoefficients[i].C * rho);

            //Calculate R1
            int nR1Coefficients = g_R1NeptuneCoefficients.Length;
            double R1 = 0;
            for (i = 0; i < nR1Coefficients; i++)
                R1 += g_R1NeptuneCoefficients[i].A * Math.Cos(g_R1NeptuneCoefficients[i].B + g_R1NeptuneCoefficients[i].C * rho);

            //Calculate R2
            int nR2Coefficients = g_R2NeptuneCoefficients.Length;
            double R2 = 0;
            for (i = 0; i < nR2Coefficients; i++)
                R2 += g_R2NeptuneCoefficients[i].A * Math.Cos(g_R2NeptuneCoefficients[i].B + g_R2NeptuneCoefficients[i].C * rho);

            //Calculate R3
            int nR3Coefficients = g_R3NeptuneCoefficients.Length;
            double R3 = 0;
            for (i = 0; i < nR3Coefficients; i++)
                R3 += g_R3NeptuneCoefficients[i].A * Math.Cos(g_R3NeptuneCoefficients[i].B + g_R3NeptuneCoefficients[i].C * rho);


            return (R0 + R1 * rho + R2 * rhosquared + R3 * rhocubed) / 100000000;
        }
    }
}
